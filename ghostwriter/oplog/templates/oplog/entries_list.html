{% extends "base_generic.html" %}
{% load crispy_forms_tags %}

{% block pagetitle %}{{ name }} Entries{% endblock %}

{% block breadcrumbs %}
    <nav aria-label="breadcrumb" style="padding-left: 20px;">
        <ul class="breadcrumb" style="margin: 0;">
            <li class="breadcrumb-item"><a href="{% url 'home:dashboard' %}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{% url 'oplog:index' %}"">Operational Logs</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ name }}</li>
        </ul>
    </nav>
{% endblock %}

{% block content %}
    <!-- Reports Table Section -->
    <table id="oplogTable" class="tablesorter">
        <thead>
            <tr>
                <th>Start Date</th>
                <th>Tool Name</th>
                <th>User Context</th>
                <th>Command</th>
                <th>Operator</th>
                <th>View/Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <p><a href="{% url 'oplog:oplog_entry_create' pk=pk%}"><i class="far fa-plus-square"></i> Create a new entry</a></p>
{% endblock %}


{% block morescripts %}
    <!-- jQuery Tablesorter Script -->
    <script>
        function updateTable() {
            $.ajax({
                type: 'GET',
                url: "{% url 'oplog:oplogentry-list' %}?oplog_id={{pk}}",
                success: function(response) {
                    $("#oplogTable").find('tbody').empty()
                    $.each(response, function(index, entry) {
                        var newRow = `<tr>
                            <td>${entry["start_date"]}</td>
                            <td>${entry["tool"]}</td>
                            <td>${entry["user_context"]}</td>
                            <td>${entry["command"]}</td>
                            <td>${entry["operator_name"]}</td>
                            <td class="clickable"><a href="/oplog/${entry['id']}/entries/update">View/Edit</a></td>
                            <td class="clickable"><a href="/oplog/${entry['id']}/entries/delete">Delete</a></td>
                            </tr>`
 
                        newRow = newRow.replace("REPLACEME", entry["id"]);

                        $("#oplogTable").append(newRow);
                    });
                },
                error: function (response) {
                    console.log("Error submitting ajax query")
                }
            });
        }

        $(document).ready(function()  {
            $("#oplogTable").tablesorter(
                            {
                                cssAsc: 'down',
                                cssDesc: 'up',
                                cssNone: 'none',
                            }
                        );
            $('.tablesorter').trigger('update');
            updateTable()
            setInterval(updateTable, 5000)
        });
 
    </script>
{% endblock %}
